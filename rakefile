require_relative 'lib/simulator'
require_relative 'lib/bin_available'

desc "Run the unit tests"
task :test do
  
  name    = ENV['NAME']
  version = ENV['VERSION']
  
  simulator = nil

  if name.nil? || version.nil?
    simulator = Simulator.random(match: /^iPhone 6$/, exact_version: 9.2)
  else 
    simulator = Simulator.random(match: name, min_version: version.to_f, max_version: (version.to_f + 1).floor)
  end
  
  puts "Testing using #{simulator}\n"
  
  sh "set -o pipefail && xcodebuild -scheme Expectation " +
  "-target Expectation " +
  "-destination id=#{simulator.udid} " +
  "-sdk iphonesimulator test | bundle exec xcpretty"
  
end

desc "Install dependencies"
task :install do
  
  sh "bundle install"
  sh "brew install swiftlint" unless bin_available? "swiftlint"
  
end

namespace :project do
  
  desc "Sort the project file and create determanistic file hashes"
  task :unique do 
    sh "xcunique Expectation.xcodeproj/project.pbxproj"
  end
  
end
